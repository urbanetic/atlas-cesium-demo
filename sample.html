<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>atlas-cesium demo</title>
  <style>
    html, body {
      padding: 0;
      margin: 0;
    }
  </style>
  <link rel="stylesheet" href="atlas-cesium/css/atlas.css">
  <script src="./atlas-cesium/lib/Requirejs/require.js"></script>
  <script>
    "use strict";
    var cesiumAtlas;

    console.debug('Requiring CesiumAtlas');

    require.config({
      baseUrl: '',
      packages: [
        { name: 'atlas/lib', location: 'atlas/lib'},
        { name: 'atlas/assets', location: 'atlas/assets'}, // Only need this for testing
        { name: 'atlas', location: 'atlas/src'},
        { name: 'atlas-cesium/cesium', location: 'atlas-cesium/lib/cesium'},
        { name: 'atlas-cesium/lib', location: 'atlas-cesium/lib'},
        { name: 'atlas-cesium', location: 'atlas-cesium/src'},
        { name: 'utility', location: 'atlas-cesium/lib/utility'},
        { name: 'jquery', location: 'lib/jquery/dist', main: 'jquery.min'}
      ]
    });

    require(['atlas-cesium/core/CesiumAtlas',
      'atlas/assets/testWKT'
    ], function(CesiumAtlas, testWKT) {
      console.debug('Creating atlas-cesium');
      var cesiumAtlas = new CesiumAtlas();

      console.debug('Attaching atlas-cesium');
      cesiumAtlas.attachTo('cesium');

      cesiumAtlas.publish('debugMode', true);

      var i = 0;
      var args = {};
      args.show = true;
      args.displayMode = 'extrusion';
      testWKT.forEach(function(wkt) {
        args.id = i++;
        args.polygon = {
          vertices: wkt,
          elevation: 0,
          height: 50
        };
        cesiumAtlas.publish('entity/show', args);
      });
      cesiumAtlas._managers.event.handleExternalEvent('camera/zoomTo', {
        position: {
          latitude: -37.8,
          longitude: 144.96,
          elevation: 2000
        }
      });

      setTimeout(function() {
        require([
          './prototypes/CameraPrototype',
          './prototypes/DrawPrototype',
        ], function(CameraPrototype, DrawPrototype) {
//          new CameraPrototype(cesiumAtlas);
          new DrawPrototype(cesiumAtlas);
        });
      }, 2000);

    });
  </script>
</head>
<body>
  <div id="cesium"></div>
</body>
</html>